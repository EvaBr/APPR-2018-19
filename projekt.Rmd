---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Tjaša Renko"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---



```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Za svojo projektno nalogo bom analizirala izpuste toplogrednih plinov po Evropi. Primerjala bom razvitost držav (BDP) z 
okoljskimi davki in letnimi izpusti.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozila sem podatke o državah v obliki CSV in s pomočjo paketa Eurostat iz spletne strani Eurostat. Podatki so podani v treh razpredelnicah.

1. `Letni izpusti toplogrednih plinov` - podatki za posamezen plin, državo in leto
  - `LETO` - spremenljivka: leto, v katerem gledamo podatke (število),
  - `DRŽAVA` - spremenljivka: ime države (neurejen faktor),
  - `EMISIJE OGLJIKOVEGA DIOKSIDA V TONAH` - meritev: letni izpust v določeni državi (število),
  - `EMISIJE OGLJIKOVEGA DIOKSIDA V TONAH` - meritev: letni izpust v določeni državi (število),
  - `EMISIJE OGLJIKOVEGA DIOKSIDA V TONAH` - meritev: letni izpust v določeni državi (število).

2. `Pregled držav` - splošni podatki, pripravljeni za primerjanje
  - `DRŽAVA` - spremenljivka: ime države(neurejen faktor),
  - `LETO` - spremenljivka: leto, v katerem gledamo podatke (število),
  - `ŠTEVILO PREBIVALCEV` - meritev: število prebivalcev določene države v določenem letu (število),
  - `GDP V MILIJONIH EVROV` - meritev: bruto domači proizvod določene države v določenem letu (število),
  - `GDP NA PREBIVALCA V EVRIH` - meritev: bruto domači proizvod na prebivalca določene države v določenem letu (število).
  
3. `Okoljski davki` - pregled obdavčitev dejavnosti, ki slabo vplivajo na okolje
  - `DRŽAVA` - spremenljivka: ime države(neurejen faktor),
  - `LETO` - spremenljivka: leto, v katerem gledamo podatke (število),
  - `DAVKI NA ENERGIJO V MILIJONIH EVROV` - meritev: (število),
  - `DAVKI NA ONESNAŽEVANJE V MILIJONIH EVROV` - meritev: (število),
  - `DAVKI NA RABO NARAVNIH VIROV V MILIJONIH EVROV` - meritev: (število),
  - `DAVKI NA PROMET V MILIJONIH EVROV` - meritev: (število),
  - `OKOLJSKI DAVKI V MILIJONIH EVROV` - meritev: (število).
  
4. `Denar za varovanje okolja` - tekoči izdatki in investicije v deležu BDP, ki ga država namenja za ohranjanje okolja
  - `DRŽAVA` - spremenljivka: ime države(neurejen faktor),
  - `LETO` - spremenljivka: leto, v katerem gledamo podatke (število),
  - `DELEŽ BDP, NAMENJEN VAROVANJU OKOLJA V OKVIRU JAVNEGA SEKTORJA` - meritev: (število),
  - `DELEŽ BDP, NAMENJEN VAROVANJU OKOLJA V OKVIRU INDUSTRIJE` - meritev: (število),
  - `DELEŽ BDP, NAMENJEN INVESTICIJAM ZA VAROVANJE OKOLJA, PORABLJENIM V JAVNEM SEKTORJU` - meritev: (število),
  - `DELEŽ BDP, NAMENJEN INVESTICIJAM ZA VAROVANJE OKOLJA, PORABLJENIM V INDUSTRIJI` - meritev: (število).

**Opomba**: da bi razpredelnica `obcine` res bila v obliki *tidy data*, bi morali odstraniti stolpec `gostota` (saj je izpeljan iz stolpcev `povrsina` in `prebivalci`), podatke o pokrajinah pa bi morali premakniti v drugo razpredelnico, saj nekatere občine pripadajo dvema pokrajinama. Podobno bi morali narediti tudi s stolpcem `odcepitev`.

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje emisije vseh toplogrednih plinov v tonah na prebivalca v letu 2013 po državah..

print(map)

Prvi graf prikazuje emisije toplogrednih plinov po državah med leti 2007 in 2016. Opazimo, da povečini rahlo upadajo.

print(graf1)

Naslednji graf primerja GDP na prebivalca z letnimi emisijami toplogrednih plinov posamezne države v tonah na prebivalca. Proti pričakovanjem se je izkazalo, da višji gdp ne pomeni manjšega izpusta, kvečjemu nasprotno.

print(graf2)

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
